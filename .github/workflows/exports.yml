name: KiCad Exports

on:
  workflow_dispatch:
  push:
  pull_request:

permissions:
  contents: read

concurrency: ci-${{ github.ref }}

jobs:
  export:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: Checkout ğŸ›ï¸
      uses: actions/checkout@v3
    
    # https://github.com/INTI-CMNB/KiBot/#usage-of-github-actions
    - name: Generate KiCad exports ğŸ”§
      uses: INTI-CMNB/KiBot@v2
      with:
        config: kibot.yaml
        dir: output
        schema: "PCB/easylight.sch"
        board: "PCB/easylight.kicad_pcb"
        
    - name: Upload results ğŸ“¦
      if: ${{ always() }}  # I want any output I can get
      uses: actions/upload-artifact@v3
      with:
        if-no-files-found: error
        name: ${{ github.event.repository.name }}
        path: output/
        
    - name: Release ğŸš€
      if: startsWith(github.ref, 'refs/tags/')        
      uses: softprops/action-gh-release@v1
      with:
        files: output/*